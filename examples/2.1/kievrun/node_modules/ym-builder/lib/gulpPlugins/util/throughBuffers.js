var through = require('through2'),
    PluginError = require('gulp-util').PluginError;

module.exports = throughBuffers;

function throughBuffers (bufferHandler, pluginName) {
    pluginName || (pluginName = 'ym-noname');

    return through.obj(function (file, encoding, cb) {
        if (file.isNull()) {
            cb(null, file);

        } else if (file.isStream()) {
            cb(new PluginError(pluginName, 'Streaming not supported', {
                fileName: file.path,
                showStack: false
            }));

        } else if (file.isBuffer()) {
            bufferHandler(file, encoding, cb);
        }
    });
}