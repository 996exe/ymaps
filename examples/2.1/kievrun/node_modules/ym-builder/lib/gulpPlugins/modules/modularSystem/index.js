var fs = require('fs'),
    path = require('path'),
    header = require('gulp-header');

module.exports = modularSystemPlugin;

function modularSystemPlugin (cfg) {
    var result = '';

    if (!cfg.standalone) {
        result = 'var ym = { modules: global.' + cfg.environment + '.modules };';
    } else {
        result = [
            'var _backupGlobalModules = global.modules;',
            fs.readFileSync(path.resolve(__dirname, 'src/ym.js')),
            'var ym = global["' + cfg.standalone + '"] = { modules: global.modules };',
            'global.modules = _backupGlobalModules; _backupGlobalModules = undefined;',
            fs.readFileSync(path.resolve(__dirname, 'src/ym-setup.js'))
        ].join('\n');
    }

    result += '\n';

    return header(result);
}